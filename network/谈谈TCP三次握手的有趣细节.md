###client第三次握手失败，双方的行为将发生如何改变？

在这之前，我们先了解一下半/全连接队列

#### 半连接队列

client第一次握手发生`syn`后，服务端将其加入半连接队列，并回复`syn seq`

 #### 全连接队列

在client 回复`ack seq`并且服务端成功收到后，服务端将其拉入自己的全连接队列



我们可以看到半连接队列和全连接队列之间会经过第三次握手，也就是客户端回复服务端syn的响应，那么如果该次回复丢失，两方的行为又是如何的呢？



#### 服务端行为

+ 超时重传

  服务端为第二次握手维护了超时重传计时器，在一定时间没有收到回复后，服务端会重发第二次握手，如果此时客户端也没有发送任何消息（即服务端没有做后续处理），那么会建立一个成功的握手。

+ 主动RST | 忽略消息

  超时重传的现象几乎无法复现，因为客户端根本不知道自己的回复丢失，它会把消息按照连接正常的情况发出。服务端收到消息，发现客户端在半连接队列，就会出现这两种行为之一：

  + 服务端发送reset:

    此时客户端会收到 `err: reset on peer`的错误信息，它立刻意识到握手失败，将会重新发起握手。

  + 忽略消息:

    大多数情况下，服务器都是这种行为，它会忽略掉除全连接队列里的客户端发来的信息，那么此时客户端会进行该消息的超时重传，如果多次超时，客户端自己就会干掉这次连接。当然，在重传过程中，也可能收到服务端发来的第二次握手，客户端也会意识到握手失败。 